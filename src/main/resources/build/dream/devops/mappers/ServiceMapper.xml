<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="build.dream.devops.mappers.ServiceMapper">
    <select id="listServiceNodes" resultType="build.dream.common.utils.UnderscoreToCamelCaseMap">
        SELECT
        host.name AS host_name,
        host.ip_address,
        host.ssh_port,
        host.user_name,
        host.password
        FROM service_node
        INNER JOIN host ON service_node.host_id = host.id AND host.deleted = 0
        WHERE service_node.deleted = 0
        AND service_node.service_id = #{serviceId}
    </select>

    <delete id="deleteJavaOperations">
        DELETE FROM java_operation WHERE service_id = #{serviceId}
    </delete>

    <delete id="deleteServiceConfigurations">
        DELETE FROM service_configuration WHERE service_id = #{serviceId}
    </delete>

    <select id="findAllServiceNodes" resultType="build.dream.common.utils.UnderscoreToCamelCaseMap">
        SELECT
        service_node.id AS service_node_id,
        host.ip_address
        FROM service_node
        INNER JOIN service ON service.id = service_node.service_id AND service.deleted = 0
        INNER JOIN host ON host.id = service_node.host_id AND host.deleted = 0
        WHERE service_node.deleted = 0;
    </select>
</mapper>